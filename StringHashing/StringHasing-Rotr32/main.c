/*
String Hasing Method 3: Rotr32

References:
    - https://github.com/vxunderground/VX-API/blob/main/VX-API/HashStringRotr32.cpp

Description:
     iterated characters in the input string to sum their ASCII values, followed by the application of a bitwise rotation to the current hash value. 
     The input value and a count (the count being INITIAL_SEED) are used to carry out a right shift on the value, then OR'd with the original value left-shifted by the negation of the count.
*/


#include <Windows.h>
#include <stdio.h>
#define SEED 5

// Helper Function that applies bitwise rotation
UINT32 StringRtor32Sub(UINT32 Value, UINT Count)
{
    // Calculate the mask to wrap the Count within the range of Value's bits
    DWORD Mask = (CHAR_BIT * sizeof(Value) - 1);
    // &= Bitwise and assignment
    Count &= Mask;
    
#pragma warning( push ) 
#pragma warning( disable : 4146)
    // Apply bitwise rotation: right shift by Count bits or left shift by (-Count) & Mask bits
    return (Value >> Count) | (Value << ((-Count) & Mask));
#pragma warning( pop ) 
}

INT HashStringRotr32A(_In_ PCHAR String)
{
    INT Value = 0;

    // For loop iterating through the characters of the input string.
    // The loop runs as long as the Index is less than the length of the string.
    for (INT Index = 0; Index < lstrlenA(String); Index++)
        // Add the ASCII value of the current character in the string to the 'Value' variable.
        // Additionally, apply a bitwise rotation operation using the 'StringRtor32Sub' function.
        // The 'SEED' value is used for the rotation.
        Value = String[Index] + StringRtor32Sub(Value, SEED);

    return Value;
}

int main() {
    CHAR* cString = "0xBinarysl3uth";

    printf("[+] The String: [ %s ] Has Hash: 0x%010X \n", cString, HashStringRotr32A(cString));
    printf("[+] Press <Enter> To Exit\n");
    getchar();
}
