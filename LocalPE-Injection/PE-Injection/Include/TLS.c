#include <Windows.h>
#include <stdio.h>
#pragma comment (linker, "/INCLUDE:_tls_used")
#pragma comment (linker, "/INCLUDE:tls_callback_func")

// Correct the type to match the TLS callback function signature
typedef void (WINAPI *PIMAGE_TLS_CALLBACK)(void*, DWORD, void*);

// Use typedef to create a const-qualified pointer type
typedef PIMAGE_TLS_CALLBACK const ConstPIMAGE_TLS_CALLBACK;

void tls_callback1(PVOID hModule, DWORD dwReason, PVOID pContext);

#pragma const_seg(".CRT$XLB")
EXTERN_C const ConstPIMAGE_TLS_CALLBACK tls_callback_func = (PIMAGE_TLS_CALLBACK)tls_callback1;
#pragma const_seg()

void tls_callback1(PVOID hModule, DWORD dwReason, PVOID pContext)
{
    if (dwReason == DLL_THREAD_ATTACH) {
        MessageBox(0, TEXT("TLS Callback 1: Thread Attach Triggered"), TEXT("TLS"), 0);
    }

    if (dwReason == DLL_PROCESS_ATTACH) {
        MessageBox(0, TEXT("TLS Callback 1: Process Attach Triggered"), TEXT("TLS"), 0);
        printf("TLS Callback Addresses:\n    Function Address: %p\n    CRT Callback Address: %p\n",
               tls_callback1, &tls_callback_func);
    }
}

int main()
{
    printf("Main():\n    0xBinary\n");
    system("pause");
    return 0;
}
